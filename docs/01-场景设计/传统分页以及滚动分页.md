---
order: 100
date created: 2026-01-12 19:48:24
date modified: 2026-01-13 11:50:04
---
# ä¼ ç»Ÿåˆ†é¡µä»¥åŠæ»šåŠ¨åˆ†é¡µ

## 1. ä¼ ç»Ÿåˆ†é¡µ

è¦æƒ³ä»æ•°æ®åº“ä¸­è¿›è¡Œåˆ†é¡µæŸ¥è¯¢ï¼Œæˆ‘ä»¬è¦ä½¿ç”¨`LIMIT`å…³é”®å­—ã€‚

æŸ¥è¯¢ç¬¬1é¡µæ•°æ®çš„SQLè¯­å¥æ˜¯ï¼š

```sql
select * from emp  limit 0 , 10;
```

æŸ¥è¯¢ç¬¬2é¡µæ•°æ®çš„SQLè¯­å¥æ˜¯ï¼š

```sql
select * from emp limit 10 , 10;
```

æŸ¥è¯¢ç¬¬3é¡µçš„æ•°æ®çš„SQLè¯­å¥æ˜¯ï¼š

```sql
select * from emp limit 20 , 10;
```

è§‚å¯Ÿä»¥ä¸ŠSQLè¯­å¥ï¼Œå‘ç°ï¼š å¼€å§‹ç´¢å¼•ä¸€ç›´åœ¨æ”¹å˜ ï¼Œ æ¯é¡µæ˜¾ç¤ºæ¡æ•°æ˜¯å›ºå®šçš„ã€‚

å¼€å§‹ç´¢å¼•çš„è®¡ç®—å…¬å¼ï¼š **å¼€å§‹ç´¢å¼• = (å½“å‰é¡µç  - 1) * æ¯é¡µæ˜¾ç¤ºæ¡æ•°**

**ç¤ºä¾‹â€”â€”ä¸šåŠ¡è¦æ±‚ï¼š**

- æ¥å£åŸºæœ¬ä¿¡æ¯

| å­—æ®µ       | æè¿°                 |
| -------- | ------------------ |
| **è·¯å¾„**   | `/admin/dish/page` |
| **æ–¹æ³•**   | `GET`              |
| **æ¥å£æè¿°** | -                  |

> [!NOTE] ğŸ“‹ ç¤ºä¾‹â€”â€”ä¸šåŠ¡è¦æ±‚
> 
> **æ¥å£åŸºæœ¬ä¿¡æ¯**
> 
> | å­—æ®µ | æè¿° |
> | :--- | :--- |
> | **è·¯å¾„** | `/admin/dish/page` |
> | **æ–¹æ³•** | `GET` |
> 
> **è¯·æ±‚å‚æ•°**
> 
> | å‚æ•°åç§° | å¿…å¡« | ç¤ºä¾‹å€¼ | å¤‡æ³¨ |
> | :--- | :---: | :--- | :--- |
> | **page** | æ˜¯ | `1` | é¡µç  |
> | **pageSize** | æ˜¯ | `10` | æ¯é¡µè®°å½•æ•° |
> 
> **è¿”å›æ•°æ®ç»“æ„**
> 
> | åç§° | ç±»å‹ | å¤‡æ³¨ |
> | :--- | :--- | :--- |
> | **code** | `int` | çŠ¶æ€ç  |
> | **data** | `obj` | æ•°æ®ä¸»ä½“ |
> | â””â”€ **records** | `arr` | èœå“åˆ—è¡¨ |
> | &emsp; â”œâ”€ **id** | `num` | ä¸»é”® |
> | &emsp; â””â”€ **name** | `str` | èœå |

**å®ç°ï¼š**

1. å®ç°ç±»

    ```java
    // å®ä½“ç±»
    @Data
    public class DishPageQueryDTO implements Serializable {
        
        private int page;
        private int pageSize;
        private String name;
        private Integer categoryId; //åˆ†ç±»id
        private Integer status; //çŠ¶æ€ 0è¡¨ç¤ºç¦ç”¨ 1è¡¨ç¤ºå¯ç”¨
    
    }
    
    @Data
    @Builder
    @NoArgsConstructor
    @AllArgsConstructor
    public class DishVO implements Serializable {
    
        private Long id;
        //èœå“åç§°
        private String name;
        //èœå“åˆ†ç±»id
        private Long categoryId;
        //èœå“ä»·æ ¼
        private BigDecimal price;
        //å›¾ç‰‡
        private String image;
        //æè¿°ä¿¡æ¯
        private String description;
        //0 åœå”® 1 èµ·å”®
        private Integer status;
        //æ›´æ–°æ—¶é—´
        private LocalDateTime updateTime;
        //åˆ†ç±»åç§°
        private String categoryName;
    }
    
    @Data
    @AllArgsConstructor
    @NoArgsConstructor
    public class PageResult implements Serializable {
    
        private long total; //æ€»è®°å½•æ•°
    
        private List records; //å½“å‰é¡µæ•°æ®é›†åˆ
    
    }
    ```

2. controllerå±‚

    ```java
    /**
     * èœå“åˆ†é¡µæŸ¥è¯¢
     *
     * @param dishPageQueryDTO
     * @return
     */
    @GetMapping("/page")
    @ApiOperation("èœå“åˆ†é¡µæŸ¥è¯¢")
    public `Result<PageResult>` page(DishPageQueryDTO dishPageQueryDTO) {
        log.info("èœå“åˆ†é¡µæŸ¥è¯¢:{}", dishPageQueryDTO);
        PageResult pageResult = dishService.pageQuery(dishPageQueryDTO);
        return Result.success(pageResult);
    }
    ```

3. serviceå±‚

    ```java
    // serviceå±‚
    public PageResult pageQuery(DishPageQueryDTO dishPageQueryDTO) {
        PageHelper.startPage(dishPageQueryDTO.getPage(), dishPageQueryDTO.getPageSize());
        `Page<DishVO>` page = dishMapper.pageQuery(dishPageQueryDTO);
        return new PageResult(page.getTotal(), page.getResult());
    }
    ```

    > [!NOTE]
    > - å¦‚æœä¸ç”¨PageHelperï¼Œéœ€è¦å…ˆ`select count(*)`è·å–åˆ°æ€»è®°å½•æ•°`total`ï¼ˆæ¥å£è¦æ±‚ä¼ é€’ç»™å‰ç«¯ï¼‰ï¼Œç„¶åæ‰‹åŠ¨æ ¹æ®`page`å’Œ`pageSize`ç®—å‡ºSQLçš„èµ·å§‹ç´¢å¼•ï¼Œç„¶åå†æ ¹æ®ç®—åˆ°çš„èµ·å§‹ç´¢å¼•å’ŒpageSizeå†å†™ä¸€æ¡SQLè¿›è¡Œæœç´¢ï¼Œæœ€åï¼Œè¿˜è¦æŠŠ`total`å’ŒæŸ¥è¯¢åˆ°çš„`list`å°è£…ä¸º`PageResult`ã€‚
    > - å¦‚æœä½¿ç”¨PageHelperï¼Œåœ¨æ‰§è¡Œ`select * from table`æ—¶ï¼ŒPageHelperå®Œæˆäº†ä»¥ä¸‹å·¥ä½œï¼š
    >     1. å…ˆè·å–åˆ°è¦æ‰§è¡Œçš„SQLè¯­å¥ï¼š`select * from table`
    >     2. æŠŠSQLè¯­å¥ä¸­çš„å­—æ®µåˆ—è¡¨ï¼Œå˜ä¸ºï¼š`count(*)`
    >     3. æ‰§è¡ŒSQLè¯­å¥ï¼š`select count(*) from table` //è·å–åˆ°æ€»è®°å½•æ•°
    >     4. å†å¯¹è¦æ‰§è¡Œçš„SQLè¯­å¥ï¼š`select * from table` è¿›è¡Œæ”¹é€ ï¼Œåœ¨æœ«å°¾æ·»åŠ `limit ? , ?`
    >     5. æ‰§è¡Œæ”¹é€ åçš„SQLè¯­å¥ï¼š`select * from tablelimit ? , ?`
    > - PageHelperä¾èµ–
    >     ```xml
    >     <dependency>
    >         <groupId>com.github.pagehelper</groupId>
    >         <artifactId>pagehelper-spring-boot-starter</artifactId>
    >         <version>1.4.2</version>
    >     </dependency>
    >     ```

4. mapperå±‚

    ```java
    // DishMapper
    `Page<DishVO>` pageQuery(DishPageQueryDTO dishPageQueryDTO); //è¦ç”¨PageHelperï¼Œè¿”å›å€¼ä¸ºPageç±»å‹
    ```

    ```xml
    <!-- DishMapper.xml -->
    <select id="pageQuery" resultType="com.sky.vo.DishVO">
            select d.* , c.name as categoryName from dish d left outer join category c on d.category_id = c.id
        <where>
            <if test="name != null">
                and d.name like concat('%',#{name},'%')
            </if>
            <if test="categoryId != null">
                and d.category_id = #{categoryId}
            </if>
            <if test="status != null">
                and d.status = #{status}
            </if>
        </where>
            order by d.create_time desc
    </select>
    ```

    > `c.name as categoryName`èµ·åˆ«åæ˜¯ä¸ºäº†è®©MyBatiså¯ä»¥æ­£ç¡®å°è£…ï¼Œå› ä¸ºDishVOä¸­çš„ä¸€ä¸ªæˆå‘˜å˜é‡æ˜¯`categoryName`

## 2. æ»šåŠ¨åˆ†é¡µ

æœ‰å¦‚ä¸‹æ¨é€ä¸šåŠ¡ï¼šæ¯ä¸ªç”¨æˆ·éƒ½å¯ä»¥å…³æ³¨è‹¥å¹²ä¸ªåšä¸»ã€‚åšä¸»å‘æ¨æ–‡å¯ä»¥æ¨é€ç»™æ‰€æœ‰ç”¨æˆ·ï¼ˆæŠŠæ¨æ–‡æ¨é€åˆ°å…³æ³¨çš„ç”¨æˆ·çš„æ”¶ä»¶ç®±ï¼‰ã€‚ç”¨æˆ·å¯ä»¥æŸ¥çœ‹é€šè¿‡æŸ¥æ”¶æ”¶ä»¶ç®±æŸ¥çœ‹å…³æ³¨çš„åšä¸»å‘é€çš„æ¨æ–‡ã€‚

> è¿™é‡Œé€šè¿‡Redisçš„Sorted Setå®ç°æ”¶ä»¶ç®±ï¼Œå› ä¸ºSorted Setæœ‰æ’åºçš„åŠŸèƒ½ã€‚

å…·ä½“å¦‚ä¸‹ï¼šå½“åšä¸»å‘é€æ¨æ–‡æ—¶ï¼Œæ¨æ–‡ä¼šè¢«æŠ•é€’åˆ°æ‰€æœ‰ç”¨æˆ·çš„æ”¶ä»¶ç®±ï¼š

![image-20241022184207678.png](https://keith-knowledge-base.oss-cn-hongkong.aliyuncs.com/image-20241022184207678.png)

åœ¨è¿™é‡Œï¼Œ`feed:15`ï¼Œ`feed:16`ï¼Œ`feed:17`åˆ†åˆ«ä¸ºuserIDä¸º15ï¼Œ16ï¼Œ17çš„ç”¨æˆ·çš„æ”¶ä»¶ç®±ã€‚userIDä¸º15çš„ç”¨æˆ·çš„æ”¶ä»¶ç®±ä¸­æœ‰5ä¸ªæ¨æ–‡ï¼Œæ¨æ–‡åœ¨æ•°æ®åº“ä¸­çš„Idåˆ†åˆ«ä¸º24ï¼Œ25ï¼Œ26ï¼Œ28ï¼Œ29ã€‚Scoreä¸ºæ”¶åˆ°æ¨æ–‡çš„æ—¶é—´æˆ³ã€‚

è¦æ±‚ç”¨æˆ·æŸ¥æ”¶æ”¶ä»¶ç®±çš„æ¨æ–‡æ—¶ï¼Œæ¨æ–‡çš„å±•ç¤ºæ—¶é—´çš„æ’åºæ˜¯ç”±è¿‘æœŸè‡³è¿œæœŸã€‚å¦‚æœç”¨åˆ†é¡µæŸ¥è¯¢ï¼ˆè§’æ ‡ï¼‰ï¼Œæ¯é¡µæŸ¥è¯¢2æ¡æ¨æ–‡ï¼Œç¬¬ä¸€é¡µä¸ºIdä¸º29ï¼Œ28çš„æ¨æ–‡ã€‚å¦‚æœåœ¨æŸ¥è¯¢ç¬¬äºŒé¡µæ—¶ï¼Œæœ‰æ–°çš„æ¨æ–‡è¢«æ¨é€åˆ°äº†æ”¶ä»¶ç®±ï¼Œé‚£ä¹ˆæ–°çš„æ¨æ–‡ä¼šæ’åˆ°æœ€å‰é¢ï¼Œæ’ç¬¬0ã€‚29æ’ç¬¬1ï¼Œ28æ’ç¬¬2ã€‚æ­¤æ—¶å†æŸ¥è¯¢ç¬¬äºŒé¡µï¼Œå°±ä¼šæŸ¥åˆ°Idä¸º28ï¼Œ26çš„æ¨æ–‡ï¼Œé‚£ä¹ˆIdä¸º28çš„æ¨æ–‡å°±è¢«é‡å¤æŸ¥è¯¢äº†ã€‚ç»¼ä¸Šï¼Œä¼ ç»Ÿçš„åˆ©ç”¨è§’æ ‡åˆ†é¡µçš„æŸ¥è¯¢ä¸å¯ç”¨ã€‚

> æ‰€ä»¥ï¼Œå…¶å®å¦‚æœæ–°æ•°æ®æ˜¯æ’å…¥è¡¨å¤´è€Œä¸æ˜¯è¡¨å°¾ï¼Œé‚£ä¹ˆä¼ ç»Ÿåˆ†é¡µæŸ¥è¯¢å°±ä¼šå‡ºé”™ã€‚

**æ»šåŠ¨åˆ†é¡µçš„å…³é”®åœ¨äºè®°å½•ä¸Šæ¬¡æŸ¥è¯¢åˆ°çš„æœ€åä¸€æ¡ï¼Œä¸‹æ¬¡æŸ¥è¯¢æ—¶å°±ä»è®°å½•çš„â€œæœ€åä¸€æ¡â€çš„ä¸‹ä¸€æ¡å¼€å§‹**ã€‚åŒæ ·å‡è®¾æ¯é¡µæŸ¥è¯¢2æ¡æ¨æ–‡ï¼Œç¬¬ä¸€æ¬¡æŸ¥è¯¢29ï¼Œ28çš„æ¨æ–‡ï¼ˆå¯ä»¥è®¤ä¸ºæ˜¯æŸ¥è¯¢Idä¸ºæ— ç©·å¤§çš„æ¨æ–‡çš„ä¸‹ä¸€æ¡ï¼‰ï¼Œå¹¶è®°å½•æœ€åä¸€æ¡æ¨æ–‡çš„Idå³ä¸º28ã€‚æ­¤æ—¶ï¼Œæœ‰æ–°çš„æ¨æ–‡è¢«æ¨é€åˆ°äº†æ”¶ä»¶ç®±ï¼Œé‚£ä¹ˆæ–°çš„æ¨æ–‡ä¼šæ’åˆ°æœ€å‰é¢ï¼Œæ’ç¬¬0ã€‚29æ’ç¬¬1ï¼Œ28æ’ç¬¬2ã€‚å†æŸ¥è¯¢ç¬¬äºŒé¡µï¼Œä»28çš„ä¸‹ä¸€æ¡å¼€å§‹æŸ¥è¯¢ï¼Œå³æŸ¥è¯¢åˆ°28ï¼Œ27ã€‚æ— è®ºæœ‰å¤šå°‘è¢«æ’åˆ°æœ€å‰é¢ï¼Œéƒ½ä¸å½±å“æ»šåŠ¨åˆ†é¡µçš„æŸ¥è¯¢ã€‚

**å…·ä½“å®ç°ï¼š**

```bash
ZREVRANGEBYSCORE key max min [WITHSCORES] [LIMIT offset count]
```

> æŸ¥è¯¢`key`çš„`score`åœ¨`min`ä¸`max`ä¹‹å‰çš„å…ƒç´ ï¼Œä»ç¬¬`offset`ä¸ªå¤§äºç­‰äº`min`çš„å…ƒç´ å¼€å§‹æŸ¥**ï¼ˆç¬¬0ä¸ªå¤§äºç­‰äº`min`çš„å…ƒç´ æ˜¯`min`æœ¬èº«ï¼‰**ï¼ŒæŸ¥è¯¢`count`ä¸ª

```bash
REVRANGEBYSCORE feed:15 9999999999999 0 withscores limit  0 2
29
1729593383369
28
1729593383366
ZREVRANGEBYSCORE feed:15 1729593383366 0 withscores limit  1 2
26
1729593383365
24
1729515335034
```

è€ƒè™‘å¦‚ä¸‹é—®é¢˜ï¼Œå¦‚æœæœ‰å¤šä¸ªç›¸åŒæ—¶é—´æˆ³ï¼ˆ`score`ï¼‰çš„æ¨æ–‡ï¼š

|ID (Total: 6)|Score|Member|
|---|---|---|
|1|1729593383369|29|
|2|1729593383366|28|
|3|1729593383366|33|
|4|1729593383366|34|
|5|1729593383365|26|
|6|1729515335034|24|

```bash
ZREVRANGEBYSCORE feed:15 999999999999999 0 withscores limit  0 3
29
1729593383369
34
1729593383366
33
1729593383366
ZREVRANGEBYSCORE feed:15 1729593383366 0 withscores limit  1 3
33
1729593383366
28
1729593383366
26
1729593383365
```

å¯ä»¥å‘ç°Idä¸º33çš„æ¨æ–‡è¢«é‡å¤æŸ¥è¯¢äº†ã€‚å› ä¸º`ZREVRANGEBYSCORE feed:15 1729593383366 0 withscores limit 1 3`æŸ¥è¯¢çš„æ˜¯ç¬¬1ä¸ªå°äºç­‰äº`1729593383366`çš„æ¨æ–‡ï¼ŒIdä¸º33çš„æ¨æ–‡æ˜¯ç¬¬ä¸€ä¸ªå°äºç­‰äº`1729593383366`çš„æ¨æ–‡ã€‚æ‰€ä»¥`offset`çš„è®¾ç½®éœ€è¦ä¾æ®æœ€åçš„å…ƒç´ çš„æ—¶é—´æˆ³çš„å…ƒç´ çš„ä¸ªæ•°ã€‚

```bash
ZREVRANGEBYSCORE feed:15 999999999999999 0 withscores limit  0 3
29
1729593383369
34
1729593383366
33
1729593383366
ZREVRANGEBYSCORE feed:15 1729593383366 0 withscores limit  2 3
28
1729593383366
26
1729593383365
24
1729515335034
```

**å…·ä½“å®ç°ï¼š**

| è¯´æ˜ | è¯¦ç»†ä¿¡æ¯ |
| :--- | :--- |
| **è¯·æ±‚æ–¹å¼** | `GET` |
| **è¯·æ±‚è·¯å¾„** | `/blog/of/follow` |
| **è¯·æ±‚å‚æ•°** | **lastId**ï¼šä¸Šä¸€æ¬¡æŸ¥è¯¢çš„æœ€å°æ—¶é—´æˆ³<br>**offset**ï¼šåç§»é‡ |
| **è¿”å›å€¼** | **`List<Blog>`**ï¼šå°äºæŒ‡å®šæ—¶é—´æˆ³çš„ç¬”è®°é›†åˆ<br>**minTime**ï¼šæœ¬æ¬¡æŸ¥è¯¢çš„æ¨é€çš„æœ€å°æ—¶é—´æˆ³<br>**offset**ï¼šåç§»é‡ |


```java
@GetMapping("/blog/of/follow")
public Result queryBlogOfFollow(
        @RequestParam("lastId") Long lastMinTimeStamp,
        @RequestParam(value = "offset", defaultValue = "0") Integer offset) {
    return blogService.queryBlogOfFollow(lastMinTimeStamp, offset);
}

@Override
public Result queryBlogOfFollow(Long lastMinTimeStamp, Integer offset) {
    UserDTO user = UserHolder.getUser(); // å½“å‰ç”¨æˆ·
    String key = "feed:" + user.getId();
    Set<ZSetOperations.`TypedTuple<String>`> typedTuples = stringRedisTemplate
            .opsForZSet().reverseRangeByScoreWithScores(key, 0, lastMinTimeStamp, offset, 3);
    
    if (typedTuples == null || typedTuples.isEmpty()) {
        return Result.ok();
    }
    
    // è¿”å›ç¬”è®°é›†åˆï¼Œæœ€å°æ—¶é—´æˆ³ï¼Œåç§»é‡
    // å…ˆæ‹¿idé›†åˆ
    `List<Long>` ids = new ArrayList<>();
    int reOffset = 1; //è¿”å›çš„åç§»é‡
    long minTimeStamp = 0;
    for (ZSetOperations.`TypedTuple<String>` typedTuple : typedTuples) {
        Long id = Long.valueOf(Objects.requireNonNull(typedTuple.getValue()));
                                                //Objects.requireNonNull é˜²æ­¢ç©ºæŒ‡é’ˆ
        ids.add(id);
        long timeStamp = Objects.requireNonNull(typedTuple.getScore()).longValue(); //scoreä¸ºæ—¶é—´æˆ³
        if (timeStamp == minTimeStamp) {
            reOffset++;
        } else if (timeStamp&lt;minTimeStamp) {
            minTimeStamp = timeStamp;
            reOffset = 1;
        }
    }
    
    `List<Blog>` blogs = blogMapper.queryByIds(ids);
    
    // 6.å°è£…å¹¶è¿”å›
    ScrollResult r = new ScrollResult();
    r.setList(blogs);
    r.setOffset(reOffset);
    r.setMinTime(minTimeStamp);

    return Result.ok(r);
}


@Data
public class ScrollResult {
    private List<?> list;
    private Long minTime;
    private Integer offset;
}
```