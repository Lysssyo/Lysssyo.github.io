# Python 基础语法

> **参考资料**: [Learn Python in Y Minutes](https://learnxinyminutes.com/zh-cn/python/)

> [!IMPORTANT] 以下内容是补充

## 1. 核心数据结构

### 字典（Dictionary）

Python 的字典不仅仅是简单的哈希表，其返回的视图对象（View Objects）具有独特的特性。

#### 1.1 字典视图 (Dictionary Views)

当你调用 `d.keys()`, `d.values()`, 或 `d.items()` 时，返回的是**视图对象**。

*   **特性**：
    1.  **不可变性 (Read-only)**：不能通过视图对象直接修改字典（无 `.append()` 或 `.remove()`）。
    2.  **动态绑定 (Dynamic)**：它不拥有数据，只是底层哈希表的**动态窗口**。字典内容变化，视图实时更新。
    3.  **Set-like (仅部分)**：`keys()` 和 `items()` 是类集合的，支持集合运算；`values()` 则不然。

#### 1.2 `list(d.keys())` vs `d.keys()`

| 特性 | `a = list(valid_dict.keys())` | `b = valid_dict.keys()` |
| :--- | :--- | :--- |
| **类型** | `list` (列表) | `dict_keys` (视图对象) |
| **内存** | **深拷贝**：开辟新空间存储所有 Key | **轻量级**：不存储数据，只引用原字典 |
| **实时性** | **静态**：字典变了，`a` 不会变 | **动态**：字典变了，`b` 自动同步 |
| **功能** | 支持索引 (`a[0]`) 和修改 | 不支持索引，主要用于迭代和成员检查 |

```python
valid_dict = {"one": 1}
a = list(valid_dict.keys())
b = valid_dict.keys()

valid_dict["two"] = 2
print(a) # ['one'] -> 静态副本
print(b) # dict_keys(['one', 'two']) -> 实时视图
```

### 1.3 常用方法对比

| 方法 | 返回内容 | 常用场景 | 集合运算 |
| :--- | :--- | :--- | :--- |
| **`d.keys()`** | 所有的键 (Key) | 成员检查 (`in`)，找共有/差异键 | **支持** |
| **`d.values()`** | 所有的值 (Value) | 只关心数据内容 | 不支持 |
| **`d.items()`** | 键值对 (Key, Value) | **绝大多数遍历场景** | **支持** (需Value可哈希) |

### 1.4 迭代器

```python
d = {"name": "Kwai", "age": 25}
# 获取第一个插入的键值对 (Python 3.7+)
first_item = next(iter(d.items())) # ('name', 'Kwai')
```

### 1.5 字典推导式

```python
# Key-Value 互换
inverted = {v: k for k, v in d.items()}
# 条件过滤
filtered = {k: v for k, v in d.items() if v > 10}
```

---

## 2. 魔法方法 (Dunder Methods)

魔法方法是 Python **鸭子类型 (Duck Typing)** 的基石，允许自定义对象表现得像内置类型。

### 2.1 表现形式：`__str__` vs `__repr__`

*   **`__str__`**: 用户导向，`print()` 时显示。追求可读性。
*   **`__repr__`**: 开发导向，调试或容器显示时调用。追求准确性（`eval(repr(obj)) == obj`）。

```python
class User:
    def __init__(self, name):
        self.name = name
    def __repr__(self):
        return f"User(name='{self.name}')"
```

### 2.2 运算符重载

让自定义对象支持 `+`, `==`, `>` 等符号。

```python
def __add__(self, other): # 重载 +
    return Vector(self.x + other.x, self.y + other.y)

def __eq__(self, other):  # 重载 ==
    return self.x == other.x and self.y == other.y
```

### 2.3 容器行为

实现以下方法让类表现得像列表或字典：
*   **`__len__(self)`**: 支持 `len(obj)`。
*   **`__getitem__(self, key)`**: 支持 `obj[key]` 访问和 `for` 循环遍历。

### 2.4 上下文管理 (with 语句)

用于资源管理，确保清理代码（如关闭文件/释放锁）一定执行。

*   **`__enter__(self)`**: 进入 `with` 块时的准备工作。
*   **`__exit__(self, exc_type, exc_val, exc_tb)`**: 退出 `with` 块时的清理工作。
