“跨域”（Cross-Origin）全称是 **Cross-Origin Resource Sharing (CORS)** 机制所针对的场景。

在浏览器眼里，一个“域”必须由 **三个死板的要素** 组成，只要有一个不一样，就是“跨域”：

1. **协议** (Protocol)：如 `http` 和 `https` 是不同的。
    
2. **域名** (Domain)：如 `localhost` 和 `baidu.com` 是不同的。
    
3. **端口** (Port)：如 `:80` 和 `:8080` 是不同的。

例如：

- **你的前端（起点）**：`http://localhost:5173`
    
- **你的后端（终点）**：`https://privatege-proxy...fcapp.run` (默认端口 443)

| **比较要素** | **前端**    | **后端**       | **结果** |
| -------- | --------- | ------------ | ------ |
| **协议**   | http      | https        | ❌ 不同   |
| **域名**   | localhost | ...fcapp.run | ❌ 不同   |
| **端口**   | 5173      | 443          | ❌ 不同   |

这就叫做跨域

2. 为什么要有这个限制？（“防盗门”的意义）

但如果没有这个限制，互联网将极其危险。想象下面这个场景：

1. 你刚刚登录了 **银行网站 (`bank.com`)**，浏览器里存着你的登录凭证（Cookie）。
    
2. 你不小心点开了一个 **恶意网站 (`evil.com`)**。
    
3. 如果没有跨域限制，`evil.com` 里的 JavaScript 代码就可以直接向 `bank.com` 发送请求：“**把这个人的钱转给我！**”
    
4. 因为你已经登录了银行，`bank.com` 看到请求带着你的 Cookie，就会以为是你自己操作的，于是钱就丢了。

**浏览器的“同源策略”（Same-Origin Policy）** 就是为了阻止这种事情：

> **浏览器规定**：`evil.com` 的页面，禁止读取 `bank.com` 的数据，除非 `bank.com` 明确点头同意。


3. 什么是 CORS（跨域资源共享）？

既然默认是禁止的，那正常的跨域需求（比如你的前端调后端）怎么办？ 这时候就需要 **CORS**（Cross-Origin Resource Sharing）这套机制了。

CORS 就像是一个**“通行证制度”**：

1. **浏览器（保安）**：看到你要从 `localhost` 去访问 `fcapp.run`，便把请求拦下（或者先发个 OPTIONS 问问）。
    
2. **浏览器问后端**：“我是 `localhost` 的人，想拿数据，行不行？”
    
3. **后端（服务器）**：如果后端在响应头里写了： `Access-Control-Allow-Origin: *` （所有人都可以进） 或者 `Access-Control-Allow-Origin: http://localhost:5173` （只准你进）
    
4. **浏览器放行**：保安看到通行证，才把数据交给你。

---

#### 第一步：准备工作

1. **购买域名**：
    
    - 去阿里云、腾讯云或 NameSilo 买一个便宜的域名。
        
    - 比如 `.top`, `.xyz`, `.site` 这种，一年可能只要几块钱人民币。
        
    - 假设你买到了：`my-knowledge.xyz`。
        
2. **新建函数（香港节点）**：
    
    - 回到阿里云 FC 控制台。
        
    - 在左上角地域选择 **“中国香港”** (Hong Kong)。
        
    - 把你在杭州的代码复制过来，新建一个一模一样的函数。
        

#### 第二步：配置 DNS 解析

你需要告诉全世界，`api.my-knowledge.xyz` 指向你的阿里云函数。

1. 在阿里云 FC（香港）控制台，找到 **“自定义域名” (Custom Domains)** 菜单。
    
2. 点击“创建域名”，它会提示你该域名的 **CNAME 接入点**（类似 `xxxx.cn-hongkong.fc.aliyuncs.com`）。**复制这个地址**。
    
3. 去你**购买域名的服务商**（比如阿里云域名控制台），找到 **DNS 解析**。
    
4. 添加一条记录：
    
    - **记录类型**：`CNAME`
        
    - **主机记录**：`api` (这样你的地址就是 `api.my-knowledge.xyz`)
        
    - **记录值**：粘贴刚才复制的阿里云 FC 接入点。
        
    - **TTL**：默认即可。
        

#### 第三步：申请免费 SSL 证书（必须！）

因为你的前端跑在 GitHub Pages (HTTPS) 上，浏览器禁止 HTTPS 页面请求 HTTP 接口（混合内容错误），所以你的 API 也必须是 HTTPS。

1. 在阿里云控制台搜索 **“SSL 证书”**（或者“数字证书管理服务”）。
    
2. 选择 **“免费证书”** -> **“创建证书”**。
    
3. 域名填写 `api.my-knowledge.xyz`。
    
4. 验证通过后（通常也是要在 DNS 里加一条记录，阿里云会自动提示），下载证书文件（通常选 Nginx 格式，包含 `.pem` 和 `.key`）。
    

#### 第四步：在 FC 控制台绑定域名

1. 回到阿里云 FC（香港）控制台 -> **自定义域名** -> **创建域名**。
    
2. **域名**：填写 `api.my-knowledge.xyz`。
    
3. **路由配置**：
    
    - 路径：`/*` (代表所有请求都转发)
        
    - 服务名称/函数名称：选择你刚才建好的那个函数。
        
4. **HTTPS 配置** (关键一步)：
    
    - 启用 HTTPS。
        
    - 把第三步下载的证书内容（Cert/PEM）和私钥（Key）粘贴进去。
        
5. 点击确定。
