# HTTPS与SSL与证书

### 证书和 SSL 是什么关系？

用一个通俗的比喻：**“护照”与“出入境通道”的关系。**

- **SSL (Secure Sockets Layer)**：
    
    - 它是一种**协议（规则）**，相当于海关的**专用安全通道**。
        
    - 它的作用是建立加密连接，防止数据在传输过程中被窃听或篡改。
        
    - _注：现在的技术标准其实叫 TLS，但大家习惯叫它 SSL。_
        
- **证书 (SSL Certificate)**：
    
    - 它就是一张**数字身份证（护照）**。
        
    - 它的作用是**证明“我是我”**。
        
    - 如果你没有这张身份证，海关（浏览器）就不让你走这个安全通道，或者会大声警告用户：“这个人身份不明，别跟他说话！”
        

**总结：** 你需要一张**证书（身份证）**，才能激活服务器上的**SSL 协议（安全通道）**，从而实现 HTTPS 访问。

### 2. DV、OV、EV 又是什么？

这三个缩写代表了**“验证等级”**。也就是发证机构（CA）在给你发身份证之前，查你查得有多严。

查得越严，证书越贵，（理论上）越值得信任。

#### 级别 1：DV 证书 (Domain Validation) —— 你的首选

- **全称**：域名验证型证书。
    
- **验证方式**：**只验证域名管理权**。
    
    - CA 机构会问：“`my-knowledge.xyz` 这个域名是你的吗？你去 DNS 里加条记录证明给我看。”
        
    - 你照做了，通过了，证书就发给你了。
        
- **耗时**：**几分钟**（全自动）。
    
- **价格**：**免费**（Let's Encrypt, 阿里云免费版）或很便宜。
    
- **浏览器显示**：显示一把小锁 🔒。
    
- **适用人群**：个人开发者、博客、中小企业官网、**你的阿里云 FC 项目**。
    

#### 级别 2：OV 证书 (Organization Validation)

- **全称**：组织验证型证书。
    
- **验证方式**：**验证域名 + 验证企业真实性**。
    
    - CA 机构不仅要你证明有域名，还会去查工商局的记录，甚至打电话确认你们公司是不是真实存在的空壳公司。
        
- **耗时**：**1-3 天**（人工审核）。
    
- **价格**：几百到几千人民币/年。
    
- **浏览器显示**：显示一把小锁 🔒，但在证书详情里能看到公司名字。
    
- **适用人群**：正规企业、电商平台。
    

#### 级别 3：EV 证书 (Extended Validation) —— 土豪专用

- **全称**：扩展验证型证书（最高等级）。
    
- **验证方式**：**查祖宗十八代**。
    
    - 非常严格的背景调查，需要提供律师函、邓白氏编码等，确保该企业完全合法且信誉良好。
        
- **耗时**：**3-7 天**甚至更久。
    
- **价格**：几千到上万人民币/年。
    
- **浏览器显示**：
    
    - **以前**：浏览器地址栏会变成**绿色**，并直接显示公司名字（比如“Apple Inc.”）。
        
    - **现在（重要！）**：主流浏览器（Chrome/Safari）**已经取消了绿色地址栏**，看起来和几十块钱的 DV 证书**没有任何区别**，只显示一把锁。只有点开锁的详细信息才能看到公司名。
        
- **适用人群**：大型银行、证券交易所、支付宝等。

### 方式 1：DNS 验证（最推荐，Serverless 首选）

这是最适合阿里云 FC 或纯后端 API 场景的方式。

- **流程**：
    
    1. **CA 给你暗号**：CA 会给你一串乱码，比如 `_dnsauth_code = x8d9s7f9s8d7f...`。
        
    2. **你贴暗号**：你需要去你的**域名解析控制台**（DNS），添加一条 **TXT 记录**（或者 CNAME 记录）。
        
        - 主机记录：`_dnsauth`
            
        - 记录值：`x8d9s7f9s8d7f...`
            
    3. **CA 检查**：CA 的服务器会去查询全球 DNS 系统：“请问 `my-knowledge.xyz` 的 TXT 记录里有没有那个暗号？”
        
    4. **通过**：查到了，验证通过。
        
- **优点**：不需要你有运行中的服务器，不需要你的网站能打开。只要你能改 DNS 就行。
    
- **阿里云的“自动 DNS 验证”**：如果你的域名是在阿里云买的，且和申请证书在同一个账号下，阿里云会自动帮你添加这条记录，你什么都不用做，点击申请后等几分钟就完事了。

- ![image.png](https://keith-knowledge-base.oss-cn-hongkong.aliyuncs.com/20260114210746641.png)


---

#### 第一步：准备工作

1. **购买域名**：
    
    - 去阿里云、腾讯云或 NameSilo 买一个便宜的域名。
        
    - 比如 `.top`, `.xyz`, `.site` 这种，一年可能只要几块钱人民币。
        
    - 假设你买到了：`my-knowledge.xyz`。
        
2. **新建函数（香港节点）**：
    
    - 回到阿里云 FC 控制台。
        
    - 在左上角地域选择 **“中国香港”** (Hong Kong)。
        
    - 把你在杭州的代码复制过来，新建一个一模一样的函数。
        

#### 第二步：配置 DNS 解析

你需要告诉全世界，`api.my-knowledge.xyz` 指向你的阿里云函数。

1. 在阿里云 FC（香港）控制台，找到 **“自定义域名” (Custom Domains)** 菜单。
    
2. 点击“创建域名”，它会提示你该域名的 **CNAME 接入点**（类似 `xxxx.cn-hongkong.fc.aliyuncs.com`）。**复制这个地址**。
    
3. 去你**购买域名的服务商**（比如阿里云域名控制台），找到 **DNS 解析**。
    
4. 添加一条记录：
    
    - **记录类型**：`CNAME`
        
    - **主机记录**：`api` (这样你的地址就是 `api.my-knowledge.xyz`)
        
    - **记录值**：粘贴刚才复制的阿里云 FC 接入点。
        
    - **TTL**：默认即可。
        

#### 第三步：申请免费 SSL 证书（必须！）

因为你的前端跑在 GitHub Pages (HTTPS) 上，浏览器禁止 HTTPS 页面请求 HTTP 接口（混合内容错误），所以你的 API 也必须是 HTTPS。

1. 在阿里云控制台搜索 **“SSL 证书”**（或者“数字证书管理服务”）。
    
2. 选择 **“免费证书”** -> **“创建证书”**。
    
3. 域名填写 `api.my-knowledge.xyz`。
    
4. 验证通过后（通常也是要在 DNS 里加一条记录，阿里云会自动提示），下载证书文件（通常选 Nginx 格式，包含 `.pem` 和 `.key`）。
    

#### 第四步：在 FC 控制台绑定域名

1. 回到阿里云 FC（香港）控制台 -> **自定义域名** -> **创建域名**。
    
2. **域名**：填写 `api.my-knowledge.xyz`。
    
3. **路由配置**：
    
    - 路径：`/*` (代表所有请求都转发)
        
    - 服务名称/函数名称：选择你刚才建好的那个函数。
        
4. **HTTPS 配置** (关键一步)：
    
    - 启用 HTTPS。
        
    - 把第三步下载的证书内容（Cert/PEM）和私钥（Key）粘贴进去。
        
5. 点击确定。